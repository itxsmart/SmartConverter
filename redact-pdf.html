<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redact PDF Online Free | Remove Sensitive Information | SmartConverter</title>
    <meta name="description" content="Redact sensitive information from PDF files online for free. Permanently remove or black out confidential text and data from PDFs." />
    <meta name="keywords" content="redact PDF, remove sensitive information, PDF redaction, black out PDF text, free PDF redactor" />
    <meta name="author" content="SmartConverter Team" />
    <meta name="robots" content="index, follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="canonical" href="https://yourwebsite.com/redact-pdf.html" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Your existing styles.css content */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }


        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            height: 100px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-container {
            display:  flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .logo span {
            color: #3498db;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: #3498db;
        }
        
        .auth-buttons a {
            margin-left: 15px;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
        }
        
        .login-btn {
            color: white;
            border: 1px solid white;
        }
        
        .register-btn {
            background-color: #3498db;
            color: white;
            border: 1px solid #3498db;
        }

        .tool-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .upload-zone {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #f8f9ff, #fff);
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: linear-gradient(45deg, #f0f4ff, #fff);
            transform: translateY(-2px);
        }

        .upload-zone.dragover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .upload-text h3 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-text p {
            color: #666;
            font-size: 1rem;
        }

        .file-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 30px;
            border-radius: 10px;
            background: #f8f9fa;
            padding: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .file-item:hover {
            transform: translateY(-2px);
        }

        .file-info {
            display: flex;
            align-items: center;
        }

        .file-icon {
            font-size: 2rem;
            color: #e74c3c;
            margin-right: 15px;
        }

        .file-details h4 {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }

        .file-details p {
            color: #666;
            font-size: 0.9rem;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 8px 12px;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .option-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .option-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .option-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .option-item:hover {
            background: #f8f9fa;
        }

        .option-item input {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .option-item label {
            cursor: pointer;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .progress-container {
            display: none;
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #333;
        }

        .result-card {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .success-icon {
            font-size: 4rem;
            color: #27ae60;
            margin-bottom: 20px;
        }

        /* PDF Redaction specific styles */
        .pdf-viewer {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pdf-canvas-container {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .pdf-canvas {
            cursor: crosshair;
            display: block;
            margin: 0 auto;
        }

        .redaction-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }

        .redaction-box {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #e74c3c;
            cursor: move;
            pointer-events: all;
        }

        .redaction-box:hover {
            border-color: #c0392b;
        }

        .redaction-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .redaction-tools {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .page-navigation {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-input {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .redaction-mode {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .redaction-mode.active {
            background: #c0392b;
        }

        .text-redaction-options {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .redaction-list {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 10px;
        }

        .redaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .redaction-item:last-child {
            border-bottom: none;
        }

        .remove-redaction {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-card {
                padding: 20px;
            }

            .redaction-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .redaction-tools,
            .page-navigation {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">Smart<span>Converter</span></a>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="tools.html">Tools</a></li>
                    <!-- <li><a href="#">Pricing</a></li> -->
                    <li><a href="about.html">About Us</a></li>
                    <!-- <li><a href="#">Contact</a></li> -->
                    <li><a href="index.html">Dashboard</a></li>
                </ul>
            </nav>
            <!-- <div class="auth-buttons">
                <a href="#" class="login-btn">Sign In</a>
                <a href="#" class="register-btn">Register</a>
            </div> -->
        </div>
    </header>
    <div class="container">
        <div class="header">
            <div class="tool-icon">
                <i class="fas fa-user-secret"></i>
            </div>
            <h1>PDF Redaction Tool</h1>
            <p>Securely redact sensitive information from your PDF documents with professional-grade tools</p>
        </div>

        <div class="main-card">
            <!-- File Upload Section -->
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    <h3>Upload PDF File</h3>
                    <p>Drag and drop your PDF file here or click to browse</p>
                    <p style="font-size: 0.9rem; margin-top: 10px; color: #999;">Supported: PDF files up to 50MB</p>
                </div>
                <input type="file" id="fileInput" accept=".pdf" style="display: none;">
            </div>

            <!-- File List -->
            <div class="file-list" id="fileList" style="display: none;">
                <!-- Files will be displayed here -->
            </div>

            <!-- PDF Viewer and Redaction Interface -->
            <div class="pdf-viewer" id="pdfViewer">
                <div class="redaction-controls">
                    <div class="redaction-tools">
                        <button class="redaction-mode active" id="areaRedactionBtn">
                            <i class="fas fa-square"></i> Area Redaction
                        </button>
                        <button class="btn btn-secondary" id="textRedactionBtn">
                            <i class="fas fa-font"></i> Text Redaction
                        </button>
                        <button class="btn btn-secondary" id="clearRedactionsBtn">
                            <i class="fas fa-eraser"></i> Clear All
                        </button>
                    </div>
                    <div class="page-navigation">
                        <button class="btn btn-secondary" id="prevPageBtn">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span>Page <input type="number" class="page-input" id="pageInput" min="1" value="1"> of <span id="totalPages">1</span></span>
                        <button class="btn btn-secondary" id="nextPageBtn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Text Redaction Options -->
                <div class="text-redaction-options" id="textRedactionOptions">
                    <h4><i class="fas fa-search"></i> Search and Redact Text</h4>
                    <input type="text" class="search-input" id="searchInput" placeholder="Enter text to redact (e.g., SSN, phone numbers, names)">
                    <div class="option-item">
                        <input type="checkbox" id="caseSensitive">
                        <label for="caseSensitive">Case sensitive search</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="wholeWord">
                        <label for="wholeWord">Match whole words only</label>
                    </div>
                    <button class="btn btn-primary" id="searchAndRedactBtn">
                        <i class="fas fa-search"></i> Find & Redact
                    </button>
                </div>

                <!-- PDF Canvas Container -->
                <div class="pdf-canvas-container" id="pdfCanvasContainer">
                    <canvas id="pdfCanvas"></canvas>
                    <div class="redaction-overlay" id="redactionOverlay"></div>
                </div>

                <!-- Redaction List -->
                <div class="redaction-list" id="redactionList">
                    <h4><i class="fas fa-list"></i> Active Redactions</h4>
                    <div id="redactionItems">
                        <p style="color: #666; text-align: center; padding: 20px;">No redactions applied yet</p>
                    </div>
                </div>
            </div>

            <!-- Redaction Options -->
            <div class="options-grid" id="redactionOptions" style="display: none;">
                <div class="option-card">
                    <h3><i class="fas fa-palette"></i> Redaction Style</h3>
                    <div class="option-item">
                        <input type="radio" id="blackRedaction" name="redactionStyle" value="black" checked>
                        <label for="blackRedaction">Black bars (secure)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="whiteRedaction" name="redactionStyle" value="white">
                        <label for="whiteRedaction">White blocks</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="blurRedaction" name="redactionStyle" value="blur">
                        <label for="blurRedaction">Blur effect</label>
                    </div>
                </div>

                <div class="option-card">
                    <h3><i class="fas fa-cog"></i> Security Options</h3>
                    <div class="option-item">
                        <input type="checkbox" id="removeMetadata" checked>
                        <label for="removeMetadata">Remove document metadata</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="flattenAnnotations" checked>
                        <label for="flattenAnnotations">Flatten all annotations</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="removeComments">
                        <label for="removeComments">Remove comments & markup</label>
                    </div>
                </div>

                <div class="option-card">
                    <h3><i class="fas fa-file-export"></i> Output Options</h3>
                    <div class="option-item">
                        <input type="checkbox" id="optimizeSize">
                        <label for="optimizeSize">Optimize file size</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="addWatermark">
                        <label for="addWatermark">Add "REDACTED" watermark</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="highQuality" name="outputQuality" value="high" checked>
                        <label for="highQuality">High quality output</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="mediumQuality" name="outputQuality" value="medium">
                        <label for="mediumQuality">Medium quality (smaller size)</label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button class="btn btn-primary" id="processRedactionBtn">
                    <i class="fas fa-user-secret"></i> Apply Redactions
                </button>
                <button class="btn btn-secondary" id="previewRedactionBtn">
                    <i class="fas fa-eye"></i> Preview Changes
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-undo"></i> Reset All
                </button>
            </div>

            <!-- Progress Container -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Processing your document...</div>
            </div>

            <!-- Result Card -->
            <div class="result-card" id="resultCard">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Redaction Complete!</h3>
                <p>Your PDF has been successfully redacted and is ready for download.</p>
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" id="downloadBtn">
                        <i class="fas fa-download"></i> Download Redacted PDF
                    </button>
                </div>
                <button class="btn btn-secondary" id="processAnotherBtn">
                    <i class="fas fa-plus"></i> Redact Another Document
                </button>
            </div>

            <!-- Security Note -->
            <div class="security-note">
                <p><i class="fas fa-shield-alt"></i> Your files are processed locally in your browser for maximum security and privacy.</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPDF = null;
        let currentPage = 1;
        let totalPages = 0;
        let redactionBoxes = [];
        let isDrawing = false;
        let startX, startY;
        let pdfDoc = null;
        let redactionMode = 'area';
        let currentFile = null;
        let scale = 1.5;
        let pdfBytes = null;
        let viewport = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            setupDragAndDrop();
        });

        function initializeEventListeners() {
            // File input
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('uploadZone').addEventListener('click', () => document.getElementById('fileInput').click());

            // Redaction mode buttons
            document.getElementById('areaRedactionBtn').addEventListener('click', () => setRedactionMode('area'));
            document.getElementById('textRedactionBtn').addEventListener('click', () => setRedactionMode('text'));

            // Page navigation
            document.getElementById('prevPageBtn').addEventListener('click', () => navigatePage(-1));
            document.getElementById('nextPageBtn').addEventListener('click', () => navigatePage(1));
            document.getElementById('pageInput').addEventListener('change', handlePageInput);

            // Text redaction
            document.getElementById('searchAndRedactBtn').addEventListener('click', searchAndRedact);

            // Canvas drawing
            const canvas = document.getElementById('pdfCanvas');
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', drawRedactionBox);
            canvas.addEventListener('mouseup', endDrawing);
            canvas.addEventListener('mouseleave', endDrawing);

            // Control buttons
            document.getElementById('clearRedactionsBtn').addEventListener('click', clearAllRedactions);
            document.getElementById('processRedactionBtn').addEventListener('click', processRedaction);
            document.getElementById('previewRedactionBtn').addEventListener('click', previewRedaction);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
            document.getElementById('processAnotherBtn').addEventListener('click', resetAll);
            document.getElementById('downloadBtn').addEventListener('click', downloadRedactedPDF);
        }

        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadZone.addEventListener(eventName, () => uploadZone.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, () => uploadZone.classList.remove('dragover'), false);
            });

            uploadZone.addEventListener('drop', handleDrop, false);
        }

        function handleDrop(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        async function handleFile(file) {
            if (file.type !== 'application/pdf') {
                alert('Please select a PDF file.');
                return;
            }

            if (file.size > 50 * 1024 * 1024) {
                alert('File size must be less than 50MB.');
                return;
            }

            currentFile = file;
            showProgress('Loading PDF document...');

            try {
                const arrayBuffer = await file.arrayBuffer();
                await loadPDF(arrayBuffer);
                displayFileInfo(file);
                showPDFViewer();
            } catch (error) {
                console.error('Error loading PDF:', error);
                alert('Error loading PDF file. Please try again.');
            } finally {
                hideProgress();
            }
        }

        async function loadPDF(arrayBuffer) {
            // Load with PDF.js for rendering
            const loadingTask = pdfjsLib.getDocument(arrayBuffer);
            currentPDF = await loadingTask.promise;
            totalPages = currentPDF.numPages;

            // Load with PDF-lib for editing
            pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

            document.getElementById('totalPages').textContent = totalPages;
            await renderPage(1);
        }

         async function renderPage(pageNum) {
            if (!currentPDF) return;

            const page = await currentPDF.getPage(pageNum);
            const canvas = document.getElementById('pdfCanvas');
            const context = canvas.getContext('2d');

            // Clear previous content
            context.clearRect(0, 0, canvas.width, canvas.height);

            viewport = page.getViewport({ scale: scale });
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };

            await page.render(renderContext).promise;
            currentPage = pageNum;
            document.getElementById('pageInput').value = pageNum;

            // Clear and redraw all redactions for this page
            updateRedactionOverlay();
        }

        function displayFileInfo(file) {
            const fileList = document.getElementById('fileList');
            const fileSize = (file.size / (1024 * 1024)).toFixed(2);
            
            fileList.innerHTML = `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-details">
                            <h4>${file.name}</h4>
                            <p>${fileSize} MB • ${totalPages} pages</p>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-danger" onclick="removeFile()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            fileList.style.display = 'block';
        }

        function showPDFViewer() {
            document.getElementById('pdfViewer').style.display = 'block';
            document.getElementById('redactionOptions').style.display = 'grid';
            document.getElementById('actionButtons').style.display = 'flex';
        }

        function setRedactionMode(mode) {
            redactionMode = mode;
            
            // Update button states
            const areaBtn = document.getElementById('areaRedactionBtn');
            const textBtn = document.getElementById('textRedactionBtn');
            
            if (mode === 'area') {
                areaBtn.classList.add('active');
                textBtn.classList.remove('active');
                document.getElementById('textRedactionOptions').style.display = 'none';
                document.getElementById('pdfCanvas').style.cursor = 'crosshair';
            } else {
                textBtn.classList.add('active');
                areaBtn.classList.remove('active');
                document.getElementById('textRedactionOptions').style.display = 'block';
                document.getElementById('pdfCanvas').style.cursor = 'text';
            }
        }

        function navigatePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                renderPage(newPage);
            }
        }

        function handlePageInput(e) {
            const pageNum = parseInt(e.target.value);
            if (pageNum >= 1 && pageNum <= totalPages) {
                renderPage(pageNum);
            } else {
                e.target.value = currentPage;
            }
        }

        function startDrawing(e) {
            if (redactionMode !== 'area') return;

            isDrawing = true;
            const rect = e.target.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
        }

        function drawRedactionBox(e) {
            if (!isDrawing || redactionMode !== 'area') return;

            const rect = e.target.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;

            // Remove temporary box if exists
            const tempBox = document.querySelector('.temp-redaction-box');
            if (tempBox) tempBox.remove();

            // Create temporary box
            const box = document.createElement('div');
            box.className = 'redaction-box temp-redaction-box';
            box.style.left = Math.min(startX, currentX) + 'px';
            box.style.top = Math.min(startY, currentY) + 'px';
            box.style.width = Math.abs(currentX - startX) + 'px';
            box.style.height = Math.abs(currentY - startY) + 'px';

            document.getElementById('redactionOverlay').appendChild(box);
        }

        function endDrawing(e) {
            if (!isDrawing || redactionMode !== 'area') return;

            isDrawing = false;
            const canvas = document.getElementById('pdfCanvas');
            const rect = canvas.getBoundingClientRect();
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;

            // Remove temporary box
            const tempBox = document.querySelector('.temp-redaction-box');
            if (tempBox) tempBox.remove();

            // Only create redaction if the box is large enough
            if (Math.abs(endX - startX) > 10 && Math.abs(endY - startY) > 10) {
                createRedactionBox(startX, startY, endX, endY);
            }
        }

         function createRedactionBox(x1, y1, x2, y2) {
            const box = document.createElement('div');
            box.className = 'redaction-box';
            
            // Calculate canvas coordinates
            const left = Math.min(x1, x2);
            const top = Math.min(y1, y2);
            const width = Math.abs(x2 - x1);
            const height = Math.abs(y2 - y1);

            // Convert to PDF coordinates (PDF y-axis starts from bottom)
            const pdfX = left / scale;
            const pdfY = (viewport.height - top) / scale - (height / scale);
            const pdfWidth = width / scale;
            const pdfHeight = height / scale;

            // Store with page reference
            redactionBoxes.push({
                page: currentPage,
                x: pdfX,
                y: pdfY,
                width: pdfWidth,
                height: pdfHeight,
                canvasLeft: left,
                canvasTop: top,
                canvasWidth: width,
                canvasHeight: height
            });

            // Set visual position on canvas
            box.style.left = left + 'px';
            box.style.top = top + 'px';
            box.style.width = width + 'px';
            box.style.height = height + 'px';

            // Add delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'remove-redaction';
            deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                box.remove();
                // Remove from redactionBoxes array
                const index = redactionBoxes.findIndex(r => 
                    r.page === currentPage &&
                    r.canvasLeft === left &&
                    r.canvasTop === top
                );
                if (index !== -1) {
                    redactionBoxes.splice(index, 1);
                }
                updateRedactionList();
            });

            box.appendChild(deleteBtn);
            document.getElementById('redactionOverlay').appendChild(box);
            updateRedactionList();
        }

        function updateRedactionList() {
            const redactionItems = document.getElementById('redactionItems');
            const boxes = document.querySelectorAll('.redaction-box:not(.temp-redaction-box)');
            
            if (boxes.length === 0) {
                redactionItems.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No redactions applied yet</p>';
                return;
            }

            redactionItems.innerHTML = '';
            boxes.forEach((box, index) => {
                const item = document.createElement('div');
                item.className = 'redaction-item';
                item.innerHTML = `
                    <span>Redaction #${index + 1} (Page ${currentPage})</span>
                    <button class="remove-redaction" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                item.querySelector('button').addEventListener('click', () => {
                    box.remove();
                    updateRedactionList();
                });
                redactionItems.appendChild(item);
            });
        }

        function searchAndRedact() {
            const searchText = document.getElementById('searchInput').value.trim();
            if (!searchText) {
                alert('Please enter text to search for');
                return;
            }

            // In a real implementation, you would search the PDF text layer
            // This is a mock implementation
            alert(`Searching for "${searchText}" would be implemented here with PDF.js text layer`);
        }

        function clearAllRedactions() {
            if (confirm('Are you sure you want to remove all redactions?')) {
                document.getElementById('redactionOverlay').innerHTML = '';
                redactionBoxes = [];
                updateRedactionList();
            }
        }

        async function processRedaction() {
            if (!pdfDoc) return;

            showProgress('Applying redactions...');

            try {
                // Simulate processing
                for (let i = 0; i <= 100; i += 5) {
                    document.getElementById('progressFill').style.width = `${i}%`;
                    document.getElementById('progressText').textContent = `Processing... ${i}%`;
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                // In a real implementation, you would:
                // 1. Apply redactions to the PDF using pdf-lib
                // 2. Process all the security options
                // 3. Generate the final PDF

                // Show result
                document.getElementById('progressContainer').style.display = 'none';
                document.getElementById('resultCard').style.display = 'block';
            } catch (error) {
                console.error('Error processing redactions:', error);
                alert('Error processing redactions. Please try again.');
                hideProgress();
            }
        }

        function previewRedaction() {
            alert('Preview functionality would show the redacted document without saving changes');
        }

          async function downloadRedactedPDF() {
            if (!pdfDoc || redactionBoxes.length === 0) {
                alert('Please add redactions before downloading');
                return;
            }

            showProgress('Generating redacted PDF...');

            try {
                // Create a copy of the original PDF to work with
                const pdfBytesCopy = await pdfDoc.save();
                const workingPdf = await PDFLib.PDFDocument.load(pdfBytesCopy);
                const pages = workingPdf.getPages();

                // Apply redactions
                redactionBoxes.forEach(box => {
                    if (box.page <= pages.length) {
                        const page = pages[box.page - 1];
                        page.drawRectangle({
                            x: box.x,
                            y: box.y,
                            width: box.width,
                            height: box.height,
                            color: PDFLib.rgb(0, 0, 0),
                            borderWidth: 0,
                            opacity: 1
                        });
                    }
                });

                // Process security options
                if (document.getElementById('removeMetadata').checked) {
                    workingPdf.setTitle('Redacted Document');
                    workingPdf.setAuthor('');
                    workingPdf.setSubject('');
                    workingPdf.setKeywords([]);
                    workingPdf.setProducer('');
                    workingPdf.setCreator('');
                }

                if (document.getElementById('addWatermark').checked) {
                    const font = await workingPdf.embedFont(PDFLib.StandardFonts.HelveticaBold);
                    pages.forEach(page => {
                        const { width, height } = page.getSize();
                        page.drawText('REDACTED', {
                            x: width / 4,
                            y: height / 2,
                            size: 50,
                            font: font,
                            color: PDFLib.rgb(0.9, 0.9, 0.9),
                            rotate: PDFLib.degrees(-45),
                            opacity: 0.3
                        });
                    });
                }

                // Save the final PDF
                const redactedPdfBytes = await workingPdf.save();

                // Create download
                const fileName = currentFile.name.replace('.pdf', '_redacted.pdf');
                const blob = new Blob([redactedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                // Show success message
                const downloadBtn = document.getElementById('downloadBtn');
                const originalText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = '<i class="fas fa-check"></i> Download Complete!';
                setTimeout(() => {
                    downloadBtn.innerHTML = originalText;
                }, 2000);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating redacted PDF. Please try again.');
            } finally {
                hideProgress();
            }
        }

        function resetAll() {
            if (confirm('Are you sure you want to reset everything? All changes will be lost.')) {
                // Reset UI
                document.getElementById('fileList').style.display = 'none';
                document.getElementById('pdfViewer').style.display = 'none';
                document.getElementById('redactionOptions').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('resultCard').style.display = 'none';
                document.getElementById('fileInput').value = '';
                document.getElementById('redactionOverlay').innerHTML = '';
                document.getElementById('redactionItems').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No redactions applied yet</p>';

                // Reset variables
                currentPDF = null;
                pdfDoc = null;
                currentPage = 1;
                totalPages = 0;
                redactionBoxes = [];
                currentFile = null;
            }
        }

        function removeFile() {
            resetAll();
        }

        function showProgress(message) {
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = message;
        }

        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }

         function updateRedactionOverlay() {
            const overlay = document.getElementById('redactionOverlay');
            overlay.innerHTML = ''; // Clear existing redactions
            
            // Only show redactions for current page
            const currentPageRedactions = redactionBoxes.filter(r => r.page === currentPage);
            
            currentPageRedactions.forEach(box => {
                const boxElement = document.createElement('div');
                boxElement.className = 'redaction-box';
                boxElement.style.left = box.canvasLeft + 'px';
                boxElement.style.top = box.canvasTop + 'px';
                boxElement.style.width = box.canvasWidth + 'px';
                boxElement.style.height = box.canvasHeight + 'px';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'remove-redaction';
                deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    boxElement.remove();
                    const index = redactionBoxes.findIndex(r => 
                        r.page === box.page &&
                        r.x === box.x &&
                        r.y === box.y
                    );
                    if (index !== -1) {
                        redactionBoxes.splice(index, 1);
                    }
                    updateRedactionList();
                });

                boxElement.appendChild(deleteBtn);
                overlay.appendChild(boxElement);
            });
        }
    </script>
</body>
</html>